<?php
// replace with db-loaded data...
// https://docs.google.com/spreadsheets/d/1yoTAu8C6zLgzXT5xW-bxa-IgIz2kcYSk4QHQ-c2xUmg/pubhtml?gid=0&single=true


$t = <<< EOF
2014-08-29,3052,1546
2014-09-05,3685,1841
2014-09-06,4269,2288
2014-09-12,4366,2218
2014-09-16,4963,2453
2014-09-18,5335,2622
2014-09-22,5843,2803
2014-09-24,6263,2917
2014-09-26,6553,3083
2014-10-01,7178,3338
2014-10-03,7470,3431
2014-10-08,8033,3865
2014-10-10,8399,4033
2014-10-15,8997,4493
2014-10-17,9216,4555
2014-10-22,9936,4877
2014-10-25,10141,4922
2014-10-29,13703,4922
2014-10-31,13567,4951
2014-11-05,13042,4818
2014-11-07,13268,4960
2014-11-12,14098,5160
2014-11-14,14413,5177
2014-11-19,15145,5420
2014-11-21,15351,5459
2014-11-26,15935,5689
2014-12-03,17145,6070
2014-12-10,17942,6388
2014-12-17,18603,6915
2014-12-24,19497,7588
2014-12-31,20206,7905
2015-01-07,20747,8235
2015-01-14,21296,8429
2015-01-21,21724,8641
2015-01-28,22057,8795
2015-02-04,22460,8966
2015-02-11,22894,9177
2015-02-18,23218,9365
2015-02-25,23729,9604
2015-03-04,23969,9807
2015-03-11,24282,9976
2015-03-18,24701,10194
2015-03-25,24907,10326
2015-04-01,25178,10445
2015-04-08,25550,10587
2015-04-15,25826,10704
2015-04-22,26044,10808
2015-04-29,26277,10884
2015-05-06,26593,11005
2015-05-13,26759,11080
2015-05-20,26969,11135
2015-05-27,27049,11149
2015-06-03,27181,11162
2015-06-10,27273,11173
2015-06-17,27341,11184
2015-06-24,27479,11222
2015-07-01,27550,11235
2015-07-08,27609,11261
2015-07-15,27678,11276
2015-07-22,27741,11284
2015-07-29,27784,11294
2015-08-05,27898,11296
2015-08-12,27965,11298
2015-08-19,27988,11299
2015-08-26,28041,11302
2015-09-02,28109,11305
2015-09-09,28183,11306
2015-09-16,28256,11306
2015-09-23,28331,11310
2015-09-30,28424,11311
2015-10-07,28457,11312
2015-10-14,28490,11312
2015-10-21,28512,11313
2015-10-28,28575,11313
2015-11-04,28607,11314
2015-11-11,28635,11314
2015-11-18,28634,11314
2015-11-25,28637,11314
2015-12-02,28637,11315
EOF;

$data = array();
$infections = array();
$deaths = array();

$t = explode("\n", trim($t) );

foreach( $t as $v ) {
    $r = explode(",", $v);
    $infections[] = $r[1];
    $deaths[] = $r[2];

    $data[] = array(
        "date" => $r[0],
        "infections" => $r[1],
        "deaths" => $r[2]
    );
}

$range = array(
    "deaths" => array(
        "min" => min($deaths), "max" => max($deaths)
    ),
    "infections" => array(
        "min" => min($infections), "max" => max($infections)
    )
);

if( isset( $_GET['callback'] ) ) {
    $retarr = array(
        "data" => $data,
        "range" => $range
    );
    printf(
        "%s(%s);\n",
        $_GET['callback'],
        json_encode( $retarr )
    );
}
